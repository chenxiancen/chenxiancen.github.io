function startbarrage(){try{clearInterval(timer),document.querySelector(".comment-barrage").innerHTML=""}catch(e){}const e={lightColors:[["var(--lyx-white-acrylic2)","var(--lyx-black)"]],darkColors:[["var(--lyx-black-acrylic2)","var(--lyx-white)"]],maxBarrage:1,barrageTime:3e3,twikooUrl:"https://love-twikoo.moyanruruo.top",accessToken:"phHbgiY3MS5prjE70ymzhXOZ",pageUrl:window.location.pathname,barrageTimer:[],barrageList:[],barrageIndex:0,noAvatarType:"retro",dom:document.querySelector(".comment-barrage"),displayBarrage:!0,avatarCDN:"gravatar.loli.net"};function a(e){var a=e;return 1==new RegExp(/http(s)?:\/\/([\w-]+\.)+[\w-]+(\/[\w- .\/?%&=]*)?/).test(a)}function r(e){const a=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;return e.offsetTop-document.documentElement.scrollTop<=a}function t(e){if(e.replies){let a=[e];return e.replies.forEach((e=>{a.push(...t(e))})),a}return[]}function n(r){let t=document.createElement("div");e.dom.clientWidth,e.dom.clientHeight;t.className="comment-barrage-item";let n=Math.floor(Math.random()*e.lightColors.length);document.getElementById("barragesColor").innerHTML=`[data-theme='light'] .comment-barrage-item { background-color:${e.lightColors[n][0]};color:${e.lightColors[n][1]}}[data-theme='dark'] .comment-barrage-item{ background-color:${e.darkColors[n][0]};color:${e.darkColors[n][1]}}`,null!=r.avatar?null!=r.link?(a(r.link)||(r.link="http://"+r.link),t.innerHTML=`\n            <div class="barrageHead">\n                <img class="barrageAvatar" src="${r.avatar}"/>\n                <a href="${r.link}" class="barrageNick" target="_blank">${r.nick}</a>\n                <a href="javascript:switchCommentBarrage()" style="font-size:20px">×</a>\n            </div>\n            <a class="barrageContent" href="#${r.id}">${r.comment}</a>\n            `):t.innerHTML=`\n            <div class="barrageHead">\n                <img class="barrageAvatar" src="${r.avatar}"/>\n                <div class="barrageNick">${r.nick}</div>\n                <a href="javascript:switchCommentBarrage()" style="font-size:20px">×</a>\n            </div>\n            <a class="barrageContent" href="#${r.id}">${r.comment}</a>\n            `:null!=r.link?(a(r.link)||(r.link="http://"+r.link),t.innerHTML=`\n            <div class="barrageHead">\n                <img class="barrageAvatar" src="https://${e.avatarCDN}/avatar/${r.mailMd5}?d=${e.noAvatarType}"/>\n                <a href="${r.link}" class="barrageNick" target="_blank">${r.nick}</a>\n                <a href="javascript:switchCommentBarrage()" style="font-size:20px">×</a>\n            </div>\n            <a class="barrageContent" href="#${r.id}">${r.comment}</a>\n            `):t.innerHTML=`\n            <div class="barrageHead">\n                <img class="barrageAvatar" src="https://${e.avatarCDN}/avatar/${r.mailMd5}?d=${e.noAvatarType}"/>\n                <div class="barrageNick">${r.nick}</div>\n                <a href="javascript:switchCommentBarrage()" style="font-size:20px">×</a>\n            </div>\n            <a class="barrageContent" href="#${r.id}">${r.comment}</a>\n            `,e.barrageTimer.push(t),e.dom.append(t)}function o(a){a.className="comment-barrage-item out",1!=e.maxBarrage?setTimeout((()=>{e.dom.removeChild(a)}),1e3):e.dom.removeChild(a)}var i,l;-1==location.href.indexOf("posts")&&-1==location.href.indexOf("posts")||(document.onscroll=function(){e.displayBarrage&&(r(document.getElementById("post-comment"))?document.getElementsByClassName("comment-barrage")[0].setAttribute("style","display:none;"):document.getElementsByClassName("comment-barrage")[0].setAttribute("style",""))}),switchCommentBarrage=function(){if(localStorage.setItem("isBarrageToggle",Number(!Number(localStorage.getItem("isBarrageToggle")))),!r(document.getElementById("post-comment"))){e.displayBarrage=!e.displayBarrage;let a=document.querySelector(".comment-barrage");a&&$(a).fadeToggle()}},$(".comment-barrage").hover((function(){clearInterval(timer)}),(function(){timer=setInterval((()=>{e.barrageList.length&&(n(e.barrageList[e.barrageIndex]),e.barrageIndex+=1,e.barrageIndex%=e.barrageList.length),e.barrageTimer.length>(e.barrageList.length>e.maxBarrage?e.maxBarrage:e.barrageList.length)&&o(e.barrageTimer.shift())}),e.barrageTime)})),null==localStorage.getItem("isBarrageToggle")?localStorage.setItem("isBarrageToggle","0"):"1"==localStorage.getItem("isBarrageToggle")&&(localStorage.setItem("isBarrageToggle","0"),switchCommentBarrage()),i=JSON.stringify({event:"COMMENT_GET","commentBarrageConfig.accessToken":e.accessToken,url:e.pageUrl}),(l=new XMLHttpRequest).withCredentials=!0,l.addEventListener("readystatechange",(function(){4===this.readyState&&(e.barrageList=function(e){e.sort(((e,a)=>e.created-a.created));let a=[];return e.forEach((e=>{a.push(...t(e))})),a}(JSON.parse(this.responseText).data),e.dom.innerHTML="")})),l.open("POST",e.twikooUrl),l.setRequestHeader("Content-Type","application/json"),l.send(i),timer=setInterval((()=>{e.barrageList.length&&(n(e.barrageList[e.barrageIndex]),e.barrageIndex+=1,e.barrageIndex%=e.barrageList.length),e.barrageTimer.length>(e.barrageList.length>e.maxBarrage?e.maxBarrage:e.barrageList.length)&&o(e.barrageTimer.shift())}),e.barrageTime)}document.addEventListener("pjax:complete",startbarrage),document.addEventListener("DOMContentLoaded",startbarrage);